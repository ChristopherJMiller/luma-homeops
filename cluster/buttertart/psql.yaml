---
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: acid-buttertart
spec:
  databases:
    postgres: postgres
  numberOfInstances: 1
  spiloRunAsUser: 101
  spiloRunAsGroup: 103
  spiloFSGroup: 103
  postgresql:
    version: '14'
  teamId: acid
  users:
    postgres: []
  volume:
    size: 2Gi
  livenessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - |-
          /usr/local/bin/supervisorctl status &&
          /usr/bin/pg_isready &&
          /usr/bin/curl -s localhost:8008 | /bin/grep '"state": "running"'
    failureThreshold: 8
    initialDelaySeconds: 60
    periodSeconds: 30
    successThreshold: 1
    timeoutSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: psql
spec:
  ports:
    - port: 5432
      targetPort: 5432
      protocol: TCP
      name: psql
  selector:
    cluster-name: acid-buttertart
